<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Test Automation - Day 4</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; color: #333; }
        h1, h2, h3 { color: #0056b3; }
        pre { background-color: #f4f4f4; padding: 10px; border-radius: 5px; overflow-x: auto; }
        code { font-family: "Courier New", Courier, monospace; color: #d44950; }
        .slide { margin-bottom: 40px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: #fff; }
    </style>
    <link rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</head>
<body>
    <h1>Web Test Automation - Day 4</h1>
    <h3>Data-Driven Testing & Advanced Fixtures</h3>

    <div class="slide">
        <h2>Agenda</h2>
        <ul>
            <li>Documenting a Manual Test Scenario</li>
            <li>Data-Driven Testing: Separating Data from Tests with JSON</li>
            <li>Implementing a Page Object for the Tool Tips Page</li>
            <li>Advanced Fixtures: Loading Data and Measuring Test Time</li>
            <li>Executing Parameterized Tests Across Different Browsers</li>
        </ul>
    </div>

    <div class="slide">
        <h2>1. Manual Test Scenario: Tool Tips</h2>
        <p><strong>Page:</strong> <a href="https://demoqa.com/tool-tips" target="_blank">Widgets -> Tool Tips</a></p>
        <ol>
            <li>Navigate to the "Tool Tips" page.</li>
            <li>Pass the mouse (hover) over the button "Hover me to see".</li>
            <li>Verify that the tooltip appears and contains the text: "You hovered over the Button".</li>
            <li>Pass the mouse over the text field "Hover me to see".</li>
            <li>Verify that the tooltip for the text field appears and contains the text: "You hovered over the text field".</li>
        </ol>
    </div>

    <div class="slide">
        <h2>2. Data-Driven Testing with `test_data.json`</h2>
        <p>We separate our test data (URLs, expected text) from our test scripts. This makes our framework much easier to maintain. If data changes, we only need to update one file.</p>
        <h3>Advantages: </h3>
        <p><strong>Improved Readability and Maintainability:</strong>Test functions become cleaner and more focused on the logic being tested when the data is externalized. This makes tests easier to understand, debug, and maintain.</p>
        <p><strong>Reduced Duplication:</strong> Instead of embedding the same data repeatedly across multiple tests, it can be defined once and reused. This minimizes redundancy and simplifies updates when data changes.</p>
        <p><strong>Enhanced Test Coverage and Efficiency: </strong>Parameterization, often used in conjunction with data separation, enables running a single test function with multiple sets of inputs and expected outputs. This efficiently increases test coverage without writing separate test functions for each scenario.</p>
        <p><strong>Easier Data Management: </strong></p>
        <p><strong> Simplified Test Code Design: </strong>Pytest fixtures can be used to set up complex test environments and provide test data, promoting reusability and separating setup concerns from the core test logic.</p>
        <p><strong> Better Isolation and Consistency: </strong>By providing distinct data sets for each test or parameterized run, isolation is maintained, ensuring tests do not interfere with each other and always run against a consistent, defined state.</p>
        
        <p>Actions:</p>
<ol>
    <li>Create a new folder into project: <code> data/</code> </li>
    <li>Create a new file: <code> test_data.json</code> </li>
    <li>Add the information bellow</li>
</ol>
        <h3>`data/test_data.json`</h3>
        <pre><code>{
  "tool_tips_url": "https://demoqa.com/tool-tips",
  "tool_tip_button_text": "You hovered over the Button",
  "tool_tip_field_text": "You hovered over the text field"
}</code></pre>
    </div>

    <div class="slide">
        <h2>3. Page Object: `tool_tips_page.py`</h2>
        <p>We create a Page Object to encapsulate all interactions with the Tool Tips page.</p>
        <pre><code>from selenium.webdriver.common.by import By
from selenium.webdriver.common.action_chains import ActionChains
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

class ToolTipsPage:
    def __init__(self, driver):
        self.driver = driver
        self.wait = WebDriverWait(self.driver, 10)
         # Locators
        self.TOOL_TIP_BUTTON = (By.ID, "toolTipButton")
        self.TOOL_TIP_FIELD = (By.ID, "toolTipTextField")
        self.TOOL_TIP_MESSAGE = (By.CSS_SELECTOR, ".tooltip-inner")

    def navigate(self, url):
        self.driver.get(url)

    def hover_over_button(self):
        button = self.driver.find_element(*self.TOOL_TIP_BUTTON)
        ActionChains(self.driver).move_to_element(button).perform()

    def hover_over_field(self):
        field = self.driver.find_element(*self.TOOL_TIP_FIELD)
        ActionChains(self.driver).move_to_element(field).perform()

    def get_tooltip_text(self):
        tooltip = self.wait.until(EC.visibility_of_element_located(self.TOOL_TIP_MESSAGE))
        return tooltip.text</code></pre>
    </div>

    <div class="slide">
        <h2>4. Advanced `conftest.py`</h2>
        <p>Our `conftest.py` is updated to load the JSON data and to time our tests.</p>
        <pre><code>import pytest
import json
import time
from pathlib import Path

# Fixture to load test data from JSON
@pytest.fixture(scope="session")
def test_data():
    with open("config/test_data.json") as f:
        return json.load(f)

LOG_FILE = Path("test_durations.log")

@pytest.hookimpl(tryfirst=True)
def pytest_runtest_setup(item):
    item.start_time = time.time()
    item.start_str = time.strftime("%H:%M:%S", time.localtime())
    msg = f"\n[START] Test '{item.nodeid}' - {item.start_str}"
    print(msg)
    
    with LOG_FILE.open("a", encoding="utf-8") as f:
        f.write(msg + "\n")

@pytest.hookimpl(trylast=True)
def pytest_runtest_teardown(item):
    duration = time.time() - item.start_time
    msg = f"[END] Test '{item.nodeid}' finished in {duration:.2f} seconds."
    print(msg)

    # salva em arquivo
    with LOG_FILE.open("a", encoding="utf-8") as f:
        f.write(msg + "\n")
</code></pre>
** scope=“session”: This fixture will only be executed once per test session, which is efficient for loading configurations.
    </div>

    <div class="slide">
        <h2>5. The Test Script: `test_tool_tips.py`</h2>
        <p>The final test is clean, readable, and data-driven. It uses the Page Object and the `test_data` fixture.</p>
        <pre><code>import pytest
from pages.tool_tips_page import ToolTipsPage

@pytest.mark.widgets
def test_button_tooltip(driver, test_data):
    """Tests the tooltip on the button."""
    tool_tips_page = ToolTipsPage(driver)
    tool_tips_page.navigate(test_data["tool_tips_url"])
    
    tool_tips_page.hover_over_button()
    
    tooltip_text = tool_tips_page.get_tooltip_text()
    assert tooltip_text == test_data["tool_tip_button_text"]

@pytest.mark.widgets
def test_field_tooltip(driver, test_data):
    """Tests the tooltip on the text field."""
    tool_tips_page = ToolTipsPage(driver)
    tool_tips_page.navigate(test_data["tool_tips_url"])
    
    tool_tips_page.hover_over_field()
    
    tooltip_text = tool_tips_page.get_tooltip_text()
    assert tooltip_text == test_data["tool_tip_field_text"]</code></pre>
    </div>

    <div class="slide">
        <h2>Challange of the day</h2>
        <p>
            <ol>
                <li>Choose a new flow to implement from scratch
                    <ol>
                    <li>Describe the manual steps before the automation script</li>
                    <li>Expected result</li>
                    </ol>
                </li>
                <li>Set up the Page Object Model
                    <ol>
                    <li>Create the new page and map the necessary objects.</li>
                    <li>Locators, URL, methods for clicking/navigating the objects</li>
                    <li>Think about what needs to be returned for validation in the script (assert)</li>
                    </ol>
                </li>
                <li>Update the test data file to include the new data 
                    <ol>
                    <li>Create the new URL that will be accessed during the test</li>
                    <li>Create the data that will be used to validate the asserts</li>
                    <li>Run the tests in Chrome and Firefox</li>
                    <li>Analyze the results</li>
                    </ol>
                </li>
            </ol>
        </p>
        <p>Happy Testing!</p>
    </div>
</body>
</html>